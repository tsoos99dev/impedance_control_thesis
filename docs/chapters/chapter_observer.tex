\chapter{Állapotmegfigyelő}\label{chap:observer}
Az állapotvisszacsatoláshoz szükséges belső állapotokra (a szögelforduláson kívül)
egy megfigyelő ad becslést. Elkülönítve a mért és becsült állapotokat~\eqref{eq:state_space_generic} felírható
\begin{equation}\label{eq:observer_state}
    \begin{split}
    \left[\begin{array}{c}
        \dot x_\RM a \\ \hline
        \dot{\BF x}_\RM b
    \end{array}\right]
    &=
    \left[\begin{array}{c|c}
        A_\RM{aa} & \BF A_\RM{a b} \\ \hline
        \BF A_\RM{ba} & \BF A_\RM{bb}
    \end{array}\right]
    \left[\begin{array}{c}
        x_\RM a \\ \hline
        \BF x_\RM b
    \end{array}\right]
    +
    \left[\begin{array}{c}
        B_\RM a \\ \hline
        \BF B_\RM b
    \end{array}\right]
    \begin{bmatrix}
        \tau_\RM e \\
        V \\
    \end{bmatrix}\,,\\
    y &= 
    \left[\begin{array}{c|c}
        1 & \BF 0
    \end{array}\right]
    \left[\begin{array}{c}
        x_\RM a \\ \hline
        \BF x_\RM b
    \end{array}\right]
    \end{split}
\end{equation}
alakban, ahol $x_\RM a = \theta$ a mért szögelfordulás és 
$\BF{x}_\RM b = [\dot \theta~~i]^{\mathsf T}$ jelöli a becsült állapotokat.
A továbbiakban jelölje $\tilde{*}$ a becsült paramétereket. Legyen
\begin{align}
    \begin{split}
    \hat{\BF A} &= \BF A_\RM{bb} - \BF K_\RM e \BF A_\RM{ab}\,,\\
    \hat{\BF B} &= \hat{\BF A} \BF K_\RM e + \BF A_\RM {ba} - \BF K_\RM e A_\RM {aa}\,,\\
    \hat{\BF F} &= \BF B_\RM b - \BF K_\RM e B_\RM a\,,
    \end{split}
\end{align}
ahol $\hat{\BF A}$ a megfigyelő belső állapotának (továbbiakban $\tilde{\BF \eta}$) 
dinamikáját adja meg, $\hat{\BF B}$ és $\hat{\BF F}$ a mért illetve a becsült állapotok 
bemeneti mátrixai. A becsült állapotok és az állapotváltozók közötti összefüggés ekkor
\begin{align}
    \begin{split}
    \BF \eta &= \BF x_\RM b - \BF K_\RM e y\,,\\
    \tilde{\BF \eta} &= \tilde{\BF x}_\RM b - \BF K_\RM e y
    \end{split}
\end{align}
alakban adható meg. A belső állapot dinamikája
\begin{align}
    \begin{split}
    \dot{\tilde{\BF \eta}} = \hat{\BF A} \tilde{\BF \eta} + \hat{\BF B} y + \hat{\BF F} u\,.
    \end{split}
\end{align}
Végül~\eqref{eq:observer_state} kimeneti egyenletének átalakításával a rendszer becsült állapotvektora
\begin{align}
    \tilde{\BF x} = \hat{\BF C} \tilde{\BF \eta} + \hat{\BF D} y\,,
\end{align}
ahol
\begin{align}
    \hat{\BF C} = 
    \left[\begin{array}{c}
        \BF 0 \\ \hline
        \BF I_{n-1}
    \end{array}\right]\,,
    \quad
    \hat{\BF D} = 
    \left[\begin{array}{c}
        1 \\ \hline
        \BF K_\RM e
    \end{array}\right]\,,
\end{align}
mely tartalmazza a mért állapotot is.